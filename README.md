Описание
Программа демонстрирует разницу между виртуальной и физической памятью, механизм ленивого выделения памяти (lazy allocation) и оптимизацию Copy-on-Write в операционных системах Linux/Unix.
Цели работы

Изучить механизм выделения памяти через malloc
Продемонстрировать разницу между виртуальной (VIRT) и физической (RES) памятью
Исследовать механизм Page Fault и ленивое выделение страниц
Сравнить производительность операций чтения и записи в память
Наблюдать работу Copy-on-Write оптимизации

Технические детали
Используемые технологии

Язык: Go 1.21+
CGO для вызова C функции malloc()
ОС: Linux/Unix

Ключевые концепции
Виртуальная vs Физическая память

Виртуальная (VIRT) - адресное пространство процесса
Физическая (RES/RSS) - реально используемая оперативная память

Lazy Allocation
malloc(2 GB) → выделяется виртуальная память
            → физическая память выделяется по требованию
Page Fault
Прерывание CPU при обращении к странице, которой нет в физической памяти.
Copy-on-Write
Оптимизация при чтении: несколько виртуальных страниц указывают на одну физическую.
Константы программы
goPAGE_SIZE      = 4096              // 4 KiB - размер страницы памяти
PAUSE_INTERVAL = 128 * 1024 * 1024 // 128 MiB - интервал пауз
Установка и компиляция
Требования

Go 1.21 или новее
GCC (для CGO)

Использование
Синтаксис
go main.go <режим> <размер_в_MiB>

Режимы:
  r - режим чтения
  w - режим записи
Примеры
bash./memtest w 512   # запись, 512 MiB
./memtest r 1024  # чтение, 1 GiB
./memtest w 2048  # запись, 2 GiB
Мониторинг использования памяти
htop
bashhtop -p $(pgrep -d, memtest)
Следить за колонками:

RES - физическая память
VIRT - виртуальная память
%MEM - процент от RAM

watch + ps
bashwatch -n 0.5 'ps aux | grep memtest | grep -v grep'
/proc
bashwatch -n 1 'cat /proc/$(pidof memtest)/status | grep -E "VmRSS|VmSize"'

Выводы
Основные результаты

Подтверждена разница между виртуальной и физической памятью

malloc() выделяет виртуальную память мгновенно
Физическая память выделяется только при обращении

Изучен механизм работы с памятью через CGO

C malloc не инициализирует память
Go GC не управляет памятью из C malloc
